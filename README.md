# ğŸ¬ Movie Recommendation API **Backend** (MVP v1)

A lightweight **Cloudflare Workers backend** that powers the Movie Recommendation Assistant frontend.  
Receives 3 guided answers from the UI â†’ calls an LLM â†’ returns a **movie recommendation with explanation**, optionally persisting data with **Prisma ORM**. [prisma](https://www.prisma.io/docs/guides/cloudflare-workers)

**Standalone backend repo** â€“ pairs with the frontend repo (`movie-recommendation`).  

***

## ğŸš€ Features (MVP)

- **Edge API on Cloudflare Workers** â€“ low latency, global deployment. [developers.cloudflare](https://developers.cloudflare.com/workers/)
- **Single JSON endpoint** â†’ `POST /api/recommend` for movie suggestions.  
- **LLM integration ready** â€“ pluggable `llmService` (Workers AI or external provider). [developers.cloudflare](https://developers.cloudflare.com/workers-ai/get-started/workers-wrangler/)
- **Prisma ORM support** â€“ optional persistence of sessions and recommendations. [developers.cloudflare](https://developers.cloudflare.com/workers/tutorials/using-prisma-postgres-with-workers/)
- **Frontendâ€‘friendly contract** â€“ matches `recommendMovie()` usage in the Vite + React app.

***

## ğŸ§  API Contract

### Endpoint

```http
POST /api/recommend
Content-Type: application/json
```

### Request body (from frontend)

```json
{
  "preferenceType": "genre | actor | theme | director | producer | color",
  "answer1": "string",
  "answer2": "string",
  "answer3": "modern | classic | other"
}
```

### Response shape

```json
{
  "movie": "Inception (2010)",
  "reason": "Matches sci-fi + modern + fast-paced preferences",
  "director": "Christopher Nolan"
}
```

This structure is designed to align exactly with the existing frontend integration.  

***

## ğŸ“ Backend Structure (v1)

```text
movie-recommendation-api/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ index.js                 # Worker entry (fetch handler)
â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â””â”€â”€ recommend.js         # /api/recommend route
â”‚   â”œâ”€â”€ controllers/
â”‚   â”‚   â””â”€â”€ recommendController.js
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ recommendService.js  # core recommendation logic
â”‚   â”‚   â””â”€â”€ llmService.js        # wraps LLM / Workers AI
â”‚   â”œâ”€â”€ db/
â”‚   â”‚   â”œâ”€â”€ prismaClient.js      # Prisma client for Workers/edge
â”‚   â”‚   â””â”€â”€ repositories/
â”‚   â”‚       â””â”€â”€ recommendationRepository.js
â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â”œâ”€â”€ validation.js        # validate payload from frontend
â”‚   â”‚   â””â”€â”€ responses.js         # JSON response helpers
â”‚   â””â”€â”€ config/
â”‚       â””â”€â”€ env.js               # read env vars from `env`
â”œâ”€â”€ prisma/
â”‚   â”œâ”€â”€ schema.prisma            # PreferenceSession + Recommendation models
â”‚   â””â”€â”€ migrations/              # generated by Prisma
â”œâ”€â”€ tests/
â”‚   â””â”€â”€ recommend.test.js        # basic endpoint tests
â”œâ”€â”€ wrangler.toml                # Cloudflare Worker configuration
â”œâ”€â”€ package.json
â””â”€â”€ README.md
```

Prisma is wired following the official Workers + Prisma guidance, using a perâ€‘request client and a Postgres/D1 adapter depending on your chosen database.

***

## ğŸš€ Quick Start

### Prerequisites

- Node.js 18+  
- Cloudflare account + `wrangler` CLI installed. [developers.cloudflare](https://developers.cloudflare.com/workers/get-started/guide/)
- A Prismaâ€‘compatible database (Prisma Postgres, Hyperdrive Postgres, or D1 via adapter). [developers.cloudflare](https://developers.cloudflare.com/hyperdrive/examples/connect-to-postgres/postgres-drivers-and-libraries/prisma-orm/)

### 1. Install dependencies

```bash
# Clone this backend repo
git clone https://github.com/jackaguilera/movie-recommendation-api.git
cd movie-recommendation-api

# Install dependencies
npm install
```

### 2. Configure Prisma

1. Update `prisma/schema.prisma` with your datasource (Postgres / D1 / Hyperdrive). [prisma](https://www.prisma.io/docs/guides/cloudflare-workers)
2. Run migrations and generate client:

```bash
npx prisma migrate dev   # apply migrations locally
npx prisma generate      # generate Prisma Client for Workers
```

### 3. Environment variables

Configure database and LLM settings in `wrangler.toml` / Cloudflare dashboard: [developers.cloudflare](https://developers.cloudflare.com/workers/tutorials/using-prisma-postgres-with-workers/)

```toml
# wrangler.toml (example)
[vars]
DATABASE_URL = "postgres://..."
LLM_API_KEY  = "your-llm-key"
```

In the Worker code these are available as `env.DATABASE_URL`, `env.LLM_API_KEY`. [developers.cloudflare](https://developers.cloudflare.com/workers-ai/get-started/workers-wrangler/)

### 4. Local development

```bash
# Start local dev server on http://127.0.0.1:8787
npm run dev   # typically runs `wrangler dev`
```

Test the API:

```bash
curl -X POST http://127.0.0.1:8787/api/recommend \
  -H "Content-Type: application/json" \
  -d '{
    "preferenceType": "genre",
    "answer1": "sci-fi",
    "answer2": "time travel",
    "answer3": "modern"
  }'
```

You should receive a JSON recommendation matching the frontendâ€™s expected shape.  

***

## ğŸŒ Production Deployment

### Deploy Worker

```bash
npm run deploy   # typically runs `wrangler deploy`
```

On success, Cloudflare returns a URL like:

```text
https://movie-recommendation-api.your-account.workers.dev
```

The frontendâ€™s `VITE_API_URL` should point to:

```env
VITE_API_URL=https://movie-recommendation-api.your-account.workers.dev/api/recommend
```

Set that environment variable in **Cloudflare Pages** for the frontend repo. [developers.cloudflare](https://developers.cloudflare.com/workers/framework-guides/web-apps/react/)

***

## ğŸ“Œ Roadmap (This Backend Repo)

### v1 â€” MVP (this repo)

- [x] `POST /api/recommend` endpoint.  
- [x] Input validation for 3â€‘question flow.  
- [x] Pluggable `llmService` abstraction.  
- [x] Optional persistence via Prisma ORM (sessions + recommendations).  

### v2

- [ ] TMDB integration for posters, ratings, and trailers.  
- [ ] Cache movie metadata in DB via Prisma.  
- [ ] Support multiple recommendations per request.  

### v3

- [ ] NLP freeâ€‘text recommendation endpoint.  
- [ ] Embeddings + vector search pipeline.  
- [ ] User accounts and saved preferences.  
- [ ] Background workflows for more complex recommendation orchestration. [blog.cloudflare](https://blog.cloudflare.com/building-workflows-durable-execution-on-workers/)

***

## ğŸ¤ Related Repos

| **Repo**                                                                             | **Purpose**                     |
| ------------------------------------------------------------------------------------ | ------------------------------- |
| [movie-recommendation-api](https://github.com/jackaguilera/movie-recommendation-api) | Cloudflare Worker + LLM backend |
| [movie-recommendation](https://github.com/jackaguilera/movie-recommendation)         | Vite + React frontend UI        |

***

**MIT** â€“ Same license as the frontend; deploy freely.
